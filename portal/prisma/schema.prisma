generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Repo {
  id            Int       @id @default(autoincrement())
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @default(now()) @updatedAt

  nhId          String    @default("")
  name          String    @unique
  description   String?
  domainPod     String?
  engineGroup   String?
  language      String?
  status        String?
  owner         String?
  defaultBranch String?
  githubUrl     String?
  notes         Json?

  syncRuns      SyncRun[]
  domains       Domain[]
}

model Domain {
  id         Int       @id @default(autoincrement())
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @default(now()) @updatedAt

  nhId       String    @default("")
  domain     String    @unique
  status     String?
  domainKey  String?
  engineType String?
  env        String?
  expiresAt  DateTime?
  notes      Json?

  repoId     Int?
  repo       Repo?     @relation(fields: [repoId], references: [id])
}

model SyncRun {
  id             Int       @id @default(autoincrement())
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @default(now()) @updatedAt

  type           String
  status         String
  trigger        String?

  startedAt      DateTime
  finishedAt     DateTime

  workflowRunUrl String?
  summary        String?
  payload        Json?

  repoId         Int?
  repo           Repo?     @relation(fields: [repoId], references: [id])
}

model JaiTool {
  id           Int       @id @default(autoincrement())
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @default(now()) @updatedAt

  name         String
  version      String?
  description  String?
  scope        String?
  status       String?

  inputSchema  Json?
  outputSchema Json?
}
